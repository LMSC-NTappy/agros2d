<?xml version="1.0"?>
<module:module xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
	xsi:schemaLocation="XMLModule ../xsd/module_xml.xsd" xmlns:module="XMLModule">

	<module:general id="acoustic" name="Acoustics">
		<module:description>Acoustics is the interdisciplinary science that
			deals with the study of all mechanical waves in gases, liquids, and
			solids.</module:description>
		<module:analyses>
                        <module:analysis id="harmonic" type="harmonic" name="Harmonic" solutions="2" />
                        <module:analysis id="transient" type="transient" name="Transient" solutions="2" />
		</module:analyses>
	</module:general>

	<module:constants>
		<module:constant id="P0" value="20e-6" />
	</module:constants>

	<module:volume>
		<module:quantity id="acoustic_density" shortname="ac_rho" />
		<module:quantity id="acoustic_speed" shortname="ac_vel" />

		<module:weakforms_volume>
			<module:weakform_volume analysistype="harmonic">
				<module:quantity id="acoustic_density" />
				<module:quantity id="acoustic_speed" />

				<module:matrix_form i="1" j="1"
					planar_linear="1 / ac_rho * (udx * vdx + udy * vdy) - (2 * PI * f)^2 / (ac_rho * ac_vel * ac_vel) * uval * vval"
					axi_linear="1 / ac_rho * r * (udr * vdr + udz * vdz) - r * (2 * PI * f)^2 / (ac_rho * ac_vel * ac_vel) * uval * vval"
					planar_newton="1 / ac_rho * (udx * vdx + udy * vdy) - (2 * PI * f)^2 / (ac_rho * ac_vel * ac_vel) * uval * vval"
					axi_newton="1 / ac_rho * r * (udr * vdr + udz * vdz) - r * (2 * PI * f)^2 / (ac_rho * ac_vel * ac_vel) * uval * vval"
					symmetric="1" />
				<module:matrix_form i="2" j="2"
					planar_linear="1 / ac_rho * (udx * vdx + udy * vdy) - (2 * PI * f)^2 / (ac_rho * ac_vel * ac_vel) * uval * vval"
					axi_linear="1 / ac_rho * r * (udr * vdr + udz * vdz) - r * (2 * PI * f)^2 / (ac_rho * ac_vel * ac_vel) * uval * vval"
					planar_newton="1 / ac_rho * (udx * vdx + udy * vdy) - (2 * PI * f)^2 / (ac_rho * ac_vel * ac_vel) * uval * vval"
					axi_newton="1 / ac_rho * r * (udr * vdr + udz * vdz) - r * (2 * PI * f)^2 / (ac_rho * ac_vel * ac_vel) * uval * vval" />
				<module:vector_form i="1" j="1" 
				 	planar_linear="0"
					axi_linear="0"
					planar_newton="1 / ac_rho * (updx * vdx + updy * vdy) - (2 * PI * f)^2 / (ac_rho * ac_vel * ac_vel) * upval * vval"
					axi_newton="1 / ac_rho * r * (updr * vdr + updz * vdz) - r * (2 * PI * f)^2 / (ac_rho * ac_vel * ac_vel) * upval * vval" />
				<module:vector_form i="2" j="2" 
					planar_linear="0"
					axi_linear="0"
					planar_newton="1 / ac_rho * (updx * vdx + updy * vdy) - (2 * PI * f)^2 / (ac_rho *ac_vel * ac_vel) * upval * vval"
					axi_newton="1 / ac_rho * r * (updr * vdr + updz * vdz) - r * (2 * PI * f)^2 / (ac_rho * ac_vel * ac_vel) * upval * vval" />
			</module:weakform_volume>

            <module:weakform_volume analysistype="transient">
                    <module:quantity id="acoustic_density" />
                    <module:quantity id="acoustic_speed" />

                    <module:matrix_form i="1" j="1"
                            planar_linear="1 / ac_rho * (udx * vdx + udy * vdy) + 1 / (ac_rho * ac_vel * ac_vel) * uval * vval / deltat"
                            axi_linear="1 / ac_rho * r * (udr * vdr + udz * vdz) - r * (2 * PI * f)^2 / (ac_rho * ac_vel * ac_vel) * uval * vval"
                            planar_newton="1 / ac_rho * (udx * vdx + udy * vdy) - (2 * PI * f)^2 / (ac_rho * ac_vel * ac_vel) * uval * vval"
                            axi_newton="1 / ac_rho * r * (udr * vdr + udz * vdz) - r * (2 * PI * f)^2 / (ac_rho * ac_vel * ac_vel) * uval * vval"
                            symmetric="1" />
                    <module:matrix_form i="2" j="2"
                            planar_linear="uval * vval / deltat"
                            axi_linear="1 / ac_rho * r * (udr * vdr + udz * vdz) - r * (2 * PI * f)^2 / (ac_rho * ac_vel * ac_vel) * uval * vval"
                            planar_newton="1 / ac_rho * (udx * vdx + udy * vdy) - (2 * PI * f)^2 / (ac_rho * ac_vel * ac_vel) * uval * vval"
                            axi_newton="1 / ac_rho * r * (udr * vdr + udz * vdz) - r * (2 * PI * f)^2 / (ac_rho * ac_vel * ac_vel) * uval * vval" />
                    <module:vector_form i="1" j="1"
                            planar_linear="1 / (ac_rho * ac_vel * ac_vel) * uptval * vval / deltat"
                            axi_linear="r * 1 / (ac_rho * ac_vel * ac_vel) * uptval * vval / deltat"
                            planar_newton="1 / ac_rho * (updx * vdx + updy * vdy) - (2 * PI * f)^2 / (ac_rho * ac_vel * ac_vel) * upval * vval"
                            axi_newton="1 / ac_rho * r * (updr * vdr + updz * vdz) - r * (2 * PI * f)^2 / (ac_rho * ac_vel * ac_vel) * upval * vval" />
                    <module:vector_form i="2" j="2"
                            planar_linear="uptval * vval / deltat"
                            axi_linear="r * uptval * vval / deltat"
                            planar_newton="1 / ac_rho * (updx * vdx + updy * vdy) - (2 * PI * f)^2 / (ac_rho * ac_vel * ac_vel) * upval * vval"
                            axi_newton="1 / ac_rho * r * (updr * vdr + updz * vdz) - r * (2 * PI * f)^2 / (ac_rho * ac_vel * ac_vel) * upval * vval" />
            </module:weakform_volume>

		</module:weakforms_volume>
	</module:volume>

	<module:surface>
        <module:quantity id="acoustic_pressure_real" shortname="ac_pr" />
        <module:quantity id="acoustic_pressure_imag" shortname="ac_pi" />
        <module:quantity id="acoustic_normal_acceleration_real" shortname="ac_anr" />
        <module:quantity id="acoustic_normal_acceleration_imag" shortname="ac_ani" />
		<module:quantity id="acoustic_impedance" shortname="ac_Z0" />

		<module:weakforms_surface>
			<module:weakform_surface analysistype="harmonic"
				default="acoustic_pressure">
				<module:boundary id="acoustic_pressure" name="Pressure">
					<module:quantity id="acoustic_pressure_real" />
					<module:quantity id="acoustic_pressure_imag" />

                    <module:essential_form i="1"
                        planar_linear="ac_pr"
                        axi_linear="ac_pr"
                        planar_newton="ac_pr"
                        axi_newton="ac_pr"/>
                    <module:essential_form i="2"
                        planar_linear="ac_pi"
                        axi_linear="ac_pi"
                        planar_newton="ac_pi"
                        axi_newton="ac_pi" />
				</module:boundary>

				<module:boundary id="acoustic_normal_acceleration"
					name="Normal acceleration">
					<module:quantity id="acoustic_normal_acceleration_real" />
					<module:quantity id="acoustic_normal_acceleration_imag" />

					<module:vector_form i="1" j="1" 
						planar_linear="ac_anr * vval"
						axi_linear="ac_anr * r * vval" 
						planar_newton="- ac_anr * vval"
						axi_newton="- ac_anr * r * vval" />
					<module:vector_form i="2" j="2" 
						planar_linear="ac_ani * vval"
						axi_linear="ac_ani * r * vval"
						planar_newton="- ac_ani * vval"
						axi_newton="- ac_ani * r * vval" />
				</module:boundary>

				<module:boundary id="acoustic_impedance" name="Impedance boundary condition">
					<module:quantity id="acoustic_impedance" />

					<module:matrix_form i="1" j="2"
						planar_linear="- 2 * PI * f / ac_Z0 * uval * vval" 
						axi_linear="- r * 2 * PI * f / ac_Z0 * uval * vval"
						planar_newton="- 2 * PI * f / ac_Z0 * uval * vval" 
						axi_newton="- r * 2 * PI * f / ac_Z0 * uval * vval"
						symmetric="1" />
					<module:matrix_form i="2" j="1"
						planar_linear="2 * PI * f / ac_Z0 * uval * vval" 
						axi_linear="r * 2 * PI * f / ac_Z0 * uval * vval"
						planar_newton="2 * PI * f / ac_Z0 * uval * vval" 
						axi_newton="r * 2 * PI * f / ac_Z0 * uval * vval"						
						symmetric="1" />
					<module:vector_form i="1" j="2" 
						planar_linear="0" 
						axi_linear="0"
						planar_newton="- 2 * PI * f / ac_Z0 * upval * vval" 
						axi_newton="- r * 2 * PI * f / ac_Z0 * upval * vval" /> 
					<module:vector_form 
						i="2" j="1" 
						planar_linear="0" 
						axi_linear="0"
						planar_newton="2 * PI * f / ac_Z0 * upval * vval" 
						axi_newton="r * 2 * PI * f / ac_Z0 * upval * vval" />
				</module:boundary>
			</module:weakform_surface>
            <module:weakform_surface analysistype="transient"
                default="acoustic_pressure">
                <module:boundary id="acoustic_pressure" name="Pressure">
                    <module:quantity id="acoustic_pressure_real" /> <!--  TODO:  update essential BCs - dependence="time" -->

                    <module:essential_form i="1"
                        planar_linear="ac_pr"
                        axi_linear="ac_pr"
                        planar_newton="ac_pr"
                        axi_newton="ac_pr"/>
                    <module:essential_form i="2"
                        planar_linear="0"
                        axi_linear="0"
                        planar_newton="0"
                        axi_newton="0" />
                </module:boundary>

                <module:boundary id="acoustic_normal_acceleration"
                    name="Normal acceleration">
                    <module:quantity id="acoustic_normal_acceleration_real" dependence="time" />

                    <module:vector_form i="1" j="1"
                        planar_linear="ac_anr * vval"
                        axi_linear="ac_anr * r * vval"
                        planar_newton="- ac_anr * vval"
                        axi_newton="- ac_anr * r * vval" />
                    <module:vector_form i="2" j="2"
                        planar_linear="0"
                        axi_linear="0"
                        planar_newton="0"
                        axi_newton="0" />
                </module:boundary>
            </module:weakform_surface>
        </module:weakforms_surface>

	</module:surface>

	<module:preprocessor>
		<module:gui type="volume">
			<module:group>
				<module:quantity id="acoustic_density" name="Mass density"
					shortname="rho" shortname_html="&lt;i&gt;&amp;rho;&lt;/i&gt;"
					shortname_latex="\rho" unit="kg/m3" unit_html="kg.m&lt;sup&gt;-3&lt;/sup&gt;"
					unit_latex="kg \cdot m^{-3}" />
				<module:quantity id="acoustic_speed" name="Speed of sound"
					shortname="vel" shortname_html="&lt;i&gt;c&lt;/i&gt;"
					shortname_latex="c" unit="m/s" unit_html="m.s&lt;sup&gt;-1&lt;/sup&gt;"
					unit_latex="m \cdot s^{-1}" />
			</module:group>
		</module:gui>
		<module:gui type="surface">
			<module:group>
				<module:quantity id="acoustic_pressure_real" name="Pressure - real"
					shortname="pr" shortname_html="&lt;i&gt;p&lt;/i&gt;&lt;sub&gt;r&lt;/sub&gt;"
					shortname_latex="p_{r}" unit="Pa" unit_html="Pa" unit_latex="Pa" />
				<module:quantity id="acoustic_pressure_imag" name="Pressure - imag"
					shortname="pi" shortname_html="&lt;i&gt;p&lt;/i&gt;&lt;sub&gt;i&lt;/sub&gt;"
					shortname_latex="p_{i}" unit="Pa" unit_html="Pa" unit_latex="Pa" />
				<module:quantity id="acoustic_normal_acceleration_real"
					name="Normal acceleration - real" shortname="anr"
					shortname_html="&lt;i&gt;an&lt;/i&gt;&lt;sub&gt;r&lt;/sub&gt;"
					shortname_latex="an_{r}" unit="m/s2" unit_html="m.s&lt;sup&gt;-2&lt;/sup&gt;"
					unit_latex="m \cdot s^{-2}" />
				<module:quantity id="acoustic_normal_acceleration_imag"
					name="Normal acceleration - imag" shortname="ani"
					shortname_html="&lt;i&gt;an&lt;/i&gt;&lt;sub&gt;i&lt;/sub&gt;"
					shortname_latex="an_{i}" unit="m/s2" unit_html="m.s&lt;sup&gt;-2&lt;/sup&gt;"
					unit_latex="m \cdot s^{-2}" />
				<module:quantity id="acoustic_impedance" name="Impedance boundary condition"
					shortname="Z0" shortname_html="&lt;i&gt;Z&lt;/i&gt;&lt;sub&gt;0&lt;/sub&gt;"
					shortname_latex="Z_{0}" unit="Pa.s/m" unit_html="Pa.s.m&lt;sup&gt;-1&lt;/sup&gt;"
					unit_latex="Pa \cdot s \cdot m^{-1}" />
			</module:group>
		</module:gui>
	</module:preprocessor>

	<module:postprocessor>
		<module:localvariables>
			<module:localvariable id="acoustic_pressure"
				name="Pressure" type="scalar" shortname="p" shortname_html="&lt;i&gt;p&lt;/i&gt;"
				shortname_latex="p" unit="Pa" unit_html="Pa" unit_latex="Pa">
				<module:expression analysistype="harmonic"
					planar="sqrt(value1^2 + value2^2)" axi="sqrt(value1^2 + value2^2)" />
			</module:localvariable>
			<module:localvariable id="acoustic_pressure_real"
				name="Pressure - real" type="scalar" shortname="pr"
				shortname_html="&lt;i&gt;p&lt;/i&gt;&lt;sub&gt;r&lt;/sub&gt;"
				shortname_latex="p_{r}" unit="Pa" unit_html="Pa" unit_latex="Pa">
				<module:expression analysistype="harmonic" planar="value1"
					axi="value1" />
                <module:expression analysistype="transient"
                    planar="value1" axi="value1" />
            </module:localvariable>
			<module:localvariable id="acoustic_pressure_imag"
				name="Pressure - imag" type="scalar" shortname="pi"
				shortname_html="&lt;i&gt;p&lt;/i&gt;&lt;sub&gt;i&lt;/sub&gt;"
				shortname_latex="p_{i}" unit="Pa" unit_html="Pa" unit_latex="Pa">
				<module:expression analysistype="harmonic" planar="value2"
					axi="value2" />
			</module:localvariable>
            <module:localvariable id="acoustic_sound_pressure_level"
                                name="Sound pressure level" type="scalar" shortname="SPL"
				shortname_html="&lt;i&gt;SPL&lt;/i&gt;" shortname_latex="SPL" unit="dB"
				unit_html="dB" unit_latex="dB">
				<module:expression analysistype="harmonic"
					planar="20 * log10(sqrt(value1^2 + value2^2) / P0)" axi="20 * log10(sqrt(value1^2 + value2^2) / P0)" />
                <module:expression analysistype="transient"
                    planar="20 * log10(value1 / P0)" axi="20 * log10(value1 / P0)" />
			</module:localvariable>
			<module:localvariable id="acoustic_local_acceleration_real"
				name="Local acceleration - real" type="vector" shortname="ar"
				shortname_html="&lt;i&gt;a&lt;/i&gt;&lt;sub&gt;r&lt;/sub&gt;"
				shortname_latex="a_{r}" unit="m/s2" unit_html="m.s&lt;sup&gt;-2&lt;/sup&gt;"
				unit_latex="m \cdot s^{-2}">
				<module:expression analysistype="harmonic"
					planar_x="- dx1 / ac_rho" planar_y="- dy1 / ac_rho" axi_r="- dr1 / ac_rho"
					axi_z="- dz1 / ac_rho" />
                <module:expression analysistype="transient"
                    planar_x="- dx1 / ac_rho" planar_y="- dy1 / ac_rho" axi_r="- dr1 / ac_rho"
                    axi_z="- dz1 / ac_rho" />
			</module:localvariable>
			<module:localvariable id="acoustic_local_acceleration_imag"
				name="Local acceleration - imag" type="vector" shortname="ai"
				shortname_html="&lt;i&gt;a&lt;/i&gt;&lt;sub&gt;i&lt;/sub&gt;"
				shortname_latex="a_{i}" unit="m/s2" unit_html="m.s&lt;sup&gt;-2&lt;/sup&gt;"
				unit_latex="m \cdot s^{-2}">
				<module:expression analysistype="harmonic"
					planar_x="- dx2 / ac_rho" planar_y="- dy2 / ac_rho" axi_r="- dr2 / ac_rho"
					axi_z="- dz2 / ac_rho" />
			</module:localvariable>
			<module:localvariable id="acoustic_density"
				name="Mass density" type="scalar" shortname="rho"
				shortname_html="&lt;i&gt;&amp;rho;&lt;/i&gt;" shortname_latex="\rho"
				unit="kg/m3" unit_html="kg.m&lt;sup&gt;-3&lt;/sup&gt;" unit_latex="kg \cdot m^{-3}">
				<module:expression analysistype="harmonic" planar="ac_rho"
					axi="ac_rho" />
                <module:expression analysistype="transient" planar="ac_rho"
                    axi="ac_rho" />
			</module:localvariable>
			<module:localvariable id="acoustic_speed" name="Speed of sound"
				type="scalar" shortname="vel" shortname_html="&lt;i&gt;c&lt;/i&gt;"
				shortname_latex="c" unit="m/s" unit_html="m.s&lt;sup&gt;-1&lt;/sup&gt;"
				unit_latex="m \cdot s^{-1}">
				<module:expression analysistype="harmonic" planar="ac_vel"
					axi="ac_vel" />
                <module:expression analysistype="transient" planar="ac_vel"
                    axi="ac_vel" />
            </module:localvariable>
		</module:localvariables>

		<module:view>
			<module:scalar_view>
                <module:default analysistype="harmonic" id="acoustic_pressure_real" />
                <module:default analysistype="transient" id="acoustic_pressure_real" />
            </module:scalar_view>
			<module:vector_view>
                <module:default analysistype="harmonic" id="acoustic_local_acceleration_real" />
                <module:default analysistype="transient" id="acoustic_local_acceleration_real" />
            </module:vector_view>
		</module:view>

		<module:volumeintegrals>
			<module:volumeintegral id="acoustic_volume"
				name="Volume" shortname="V" shortname_html="&lt;i&gt;V&lt;/i&gt;"
				shortname_latex="V" unit="m3" unit_html="m&lt;sup&gt;3&lt;/sup&gt;"
				unit_latex="m^{3}">
				<module:expression analysistype="harmonic" planar="1.0"
					axi="2.0 * PI * r" />
                <module:expression analysistype="transient" planar="1.0"
                    axi="2.0 * PI * r" />
                </module:volumeintegral>
			<module:volumeintegral id="acoustic_cross_section"
				name="Cross section" shortname="S" shortname_html="&lt;i&gt;S&lt;/i&gt;"
				shortname_latex="S" unit="m2" unit_html="m&lt;sup&gt;2&lt;/sup&gt;"
				unit_latex="m^{2}">
				<module:expression analysistype="harmonic" planar="1.0"
					axi="1.0" />
                <module:expression analysistype="transient" planar="1.0"
                    axi="1.0" />
			</module:volumeintegral>
		</module:volumeintegrals>

		<module:surfaceintegrals>
			<module:surfaceintegral id="acoustic_length"
				name="Length" shortname="l" shortname_html="&lt;i&gt;l&lt;/i&gt;"
				shortname_latex="l" unit="m" unit_html="m" unit_latex="m">
                <module:expression analysistype="harmonic" planar="1.0"
                    axi="1.0" />
                <module:expression analysistype="transient" planar="1.0"
                    axi="1.0" />
            </module:surfaceintegral>
			<module:surfaceintegral id="acoustic_surface"
				name="Surface" shortname="S" shortname_html="&lt;i&gt;S&lt;/i&gt;"
				shortname_latex="S" unit="m2" unit_html="m&lt;sup&gt;2&lt;/sup&gt;"
				unit_latex="m^{2}">
                <module:expression analysistype="harmonic" planar="1.0"
                    axi="2.0 * PI * r" />
                <module:expression analysistype="transient" planar="1.0"
                    axi="2.0 * PI * r" />
            </module:surfaceintegral>
		</module:surfaceintegrals>

        <module:force />
	</module:postprocessor>
</module:module>
