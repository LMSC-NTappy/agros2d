<?xml version="1.0"?>
<module xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xsi:noNamespaceSchemaLocation="module.xsd">
    <general id ="current" name="Current field">
        <description>Electric current is a flow of electric charge through a medium. This charge is typically carried by moving electrons in a conductor such as wire. It can also be carried by ions in an electrolyte, or by both ions and electrons in a plasma.</description>
        <properties steadystate="1" harmonic="0" transient="0" />
        <analyses>
            <analysis id="steadystate" type="steadystate" name="Steady state" />
        </analyses>
    </general>

    <constants>
        <constant id="" value="" />
    </constants>

    <macros>
        <macro id="" expression="" />
    </macros>

    <volume>
        <quantity id="current_conductivity" shortname="gamma" />
        
        <weakforms>
            <weakform analysistype="steadystate">
                <quantity id="current_conductivity" />

                <matrix i="1" j="1" planar="gamma * (udx * vdx + udy * vdy)"
                                    axi="gamma * r * (udr * vdr + udz * vdz)" symmetric="1" />
                <vector i="1" j="1" planar="gamma * (updx * vdx + updy * vdy)"
                                    axi="gamma * r * (updr * vdr + updz * vdz)" />
            </weakform>
        </weakforms>
    </volume>

    <surface>
        <quantity id="current_potential" shortname="V" />
        <quantity id="current_inward_current_flow" shortname="Jn" />
    	
        <weakforms>
            <weakform analysistype="steadystate" default="current_potential">
                <boundary id="current_potential" name="Fixed voltage">
                    <quantity id="current_potential" />

                    <essential i="1" planar="V"
                                     axi="V" />
                </boundary>

                <boundary id="current_inward_current_flow" name="Current density">
                    <quantity id="current_inward_current_flow" />

                    <vector i="1" j="1" planar="- Jn * vval"
                                        axi="- Jn * r * vval" />
                </boundary>
            </weakform>
        </weakforms>
    </surface>

    <preprocessor>
        <volume>
            <group>
                <quantity id="current_conductivity" name="Conductivity" shortname="gamma" unit="S/m" unit_html="S.m<sup>-1</sup>" unit_latex="S \cdot m^{-1}" />
            </group>
        </volume>
        <surface>
            <group>
                <quantity id="current_potential" name="Fixed voltage" shortname="V" unit="V" />
                <quantity id="current_inward_current_flow" name="Current density" shortname="Jn" unit="A/m2" unit_html="A.m<sup>-2</sup>" unit_latex="A \cdot m^{-2}" />
            </group>
        </surface>
    </preprocessor>

    <postprocessor>
        <localvariables>
            <localvariable id="current_potential" name="Scalar potential" shortname="V" unit="V" type="scalar">
                <expression analysistype="steadystate" planar="value1"
                                                       axi="value1" />
            </localvariable>
            <localvariable id="current_electric_field" name="Electric field" shortname="E" unit="V/m" unit_html="V.m<sup>-1</sup>" unit_latex="V \cdot m^{-1}" type="vector">
                <expression analysistype="steadystate" planar_x="- dx1"
                                                       planar_y="- dy1"
                                                       axi_r="- dr1"
                                                       axi_z="- dz1" />
            </localvariable>
            <localvariable id="current_current_density" name="Current density" shortname="J" unit="A/m2" unit_html="A.m<sup>-2</sup>" unit_latex="A \cdot m^{-2}" type="vector">
                <expression analysistype="steadystate" planar_x="- gamma * dx1"
                                                       planar_y="- gamma * dy1"
                                                       axi_r="- gamma * dr1"
                                                       axi_z="- gamma * dz1" />
            </localvariable>
            <localvariable id="current_joule_losses" name="Joule losses" shortname="pj" unit="W/m3" unit_html="W.m<sup>-3</sup>" unit_latex="W \cdot m^{-3}" type="scalar">
                <expression analysistype="steadystate" planar="gamma * (dx1 * dx1 + dy1 * dy1)"
                                                       axi="gamma * (dr1 * dr1 + dz1 * dz1)" />
            </localvariable>
            <localvariable id="current_conductivity" name="Conductivity" shortname="gamma" unit="S/m" unit_html="S.m<sup>-1</sup>" unit_latex="S \cdot m^{-1}" type="scalar">
                <expression analysistype="steadystate" planar="gamma"
                                                       axi="gamma" />
            </localvariable>
        </localvariables>

        <view>
            <scalar>
                <default analysistype="steadystate" id="current_potential" />
            </scalar>
            <vector>
                <default analysistype="steadystate" id="current_current_density" />
            </vector>
        </view>

        <volumeintegrals>
            <volumeintegral id="current_volume" name="Volume" shortname="V" unit="m3" unit_html="m<sup>3</sup>" unit_latex="m^{3}">
                <expression analysistype="steadystate" planar="1.0"
                                                       axi="2.0 * PI * r" />
            </volumeintegral>
            <volumeintegral id="current_cross_section" name="Cross section" shortname="S" unit="m2" unit_html="m<sup>2</sup>" unit_latex="m^{2}">
                <expression analysistype="steadystate" planar="1.0"
                                                       axi="1.0" />
            </volumeintegral>
            <volumeintegral id="current_joule_losses" name="Joule losses" shortname="Pj" unit="W">
                <expression analysistype="steadystate" planar="gamma * (dx1 * dx1 + dy1 * dy1)"
                                                       axi="2.0 * PI * r * gamma * (dr1 * dr1 + dz1 * dz1)" />
            </volumeintegral>
        </volumeintegrals>

        <surfaceintegrals>
            <surfaceintegral id="length" name="Length" shortname="l" unit="m">
                <expression analysistype="steadystate" planar="1.0"
                                                       axi="1.0" />
            </surfaceintegral>
            <surfaceintegral id="surface" name="Surface" shortname="S" unit="m2" unit_html="m<sup>2</sup>" unit_latex="m^{2}">
                <expression analysistype="steadystate" planar="1.0"
                                                       axi="2.0 * PI * r" />
            </surfaceintegral>
            <surfaceintegral id="current_current" name="Current" shortname="I" unit="A">
                <expression analysistype="steadystate" planar="gamma * (tanx * dy1 - tany * dx1)"
                                                       axi="2.0 * PI * r * gamma * (tanr * dz1 - tanz * dr1)" />
            </surfaceintegral>
        </surfaceintegrals>
    </postprocessor>
</module>
