<?xml version="1.0"?>
<module xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xsi:noNamespaceSchemaLocation="module.xsd">
    <general id ="rf" name="RF">
        <description>Solving TE waves in RF field.</description>
        <analyses>
            <analysis id="harmonic" type="harmonic" name="Harmonic" />
        </analyses>
    </general>

    <constants>
        <constant id="EPS0" value="8.854e-12" />
        <constant id="MU0" value="1.2566371e-06" />
    </constants>

    <macros>
        <macro id="" expression="" />
    </macros>
    
    <volume>
        <quantity id="rf_permittivity" shortname="epsr" />
        <quantity id="rf_permeability" shortname="mur" />
        <quantity id="rf_conductivity" shortname="gamma" />
        <quantity id="rf_current_density_external_real" shortname="Jer" />
        <quantity id="rf_current_density_external_imag" shortname="Jei" />
        
        <weakforms>
            <weakform analysistype="harmonic">
                <material id="rf_permittivity" />
                <material id="rf_permeability" />
                <material id="rf_conductivity" />
                <material id="rf_current_density_external_real" />
                <material id="rf_current_density_external_imag" />

                <matrix i="1" j="1" planar="- 1 / (mur * MU0) * (udx * vdx + udy * vdy) + (2 * PI * f)^2 * epsr * EPS0 * uval * vval"
                                    axi="" symmetric="1" />
                <matrix i="2" j="2" planar="- 1 / (mur * MU0) * (udx * vdx + udy * vdy) + (2 * PI * f)^2 * epsr * EPS0 * uval * vval"
                                    axi="" symmetric="1" />
            </weakform>
        </weakforms>
    </volume>

    <surface>
        <quantity id="rf_electric_field_real" shortname="Er" />
        <quantity id="rf_electric_field_imag" shortname="Ei" />
        <quantity id="rf_magnetic_field_real" shortname="Hr" />
        <quantity id="rf_magnetic_field_imag" shortname="Hi" />
        <quantity id="rf_surface_current_real" shortname="Jr" />
        <quantity id="rf_surface_current_imag" shortname="Ji" />
        <quantity id="rf_port_power" shortname="P" />
        <quantity id="rf_port_phase" shortname="alpha" />
    	
        <weakforms>
            <weakform analysistype="harmonic" default="rf_electric_field">
                <boundary id="rf_electric_field" name="Electric field">
                    <quantity id="rf_electric_field_real" />
                    <quantity id="rf_electric_field_imag" />

                    <essential i="1" planar="Er"
                                     axi="Er" />
                    <essential i="1" planar="Ei"
                                     axi="Ei" />
                </boundary>

                <boundary id="rf_magnetic_field" name="Magnetic field">
                    <quantity id="rf_magnetic_field_real" />
                    <quantity id="rf_magnetic_field_imag" />

                    <vector i="1" j="1" planar="Hr * vval"
                                        axi="Hr * r * vval" />
                    <vector i="2" j="2" planar="Hi * vval"
                                        axi="Hi * r * vval" />
                </boundary>

                <boundary id="rf_surface_current" name="Surface current">
                    <quantity id="rf_surface_current_real" />
                    <quantity id="rf_surface_current_imag" />

                    <vector i="1" j="1" planar="Hr * vval"
                                        axi="Hr * r * vval" />
                    <vector i="2" j="2" planar="Hi * vval"
                                        axi="Hi * r * vval" />
                </boundary>

                <boundary id="rf_port" name="Port">
                    <quantity id="rf_port_power" />
                    <quantity id="rf_port_phase" />

                    <matrix i="1" j="2" planar="uval * vval"
                                        axi="uval * vval" symmetric="1" />
                    <matrix i="2" j="1" planar="uval * vval"
                                        axi="uval * vval" symmetric="1" />
                </boundary>

                <boundary id="acoustic_matched_boundary" name="Matched boundary" >
                </boundary>
            </weakform>
        </weakforms>
    </surface>

    <preprocessor>
        <volume>
            <group>
                <quantity id="rf_permittivity" name="Permittivity" shortname="epsr" unit="-" />
                <quantity id="rf_permeability" name="Permeability" shortname="mur" unit="-" />
                <quantity id="rf_conductivity" name="Conductivity" shortname="gamma" unit="S/m" unit_html="S.m<sup>-1</sup>" unit_latex="S \cdot m^{-1}"/>
                <quantity id="rf_current_density_external_real" name="Current dens. - ext. - real" shortname="Jer" unit="A/m2" unit_html="A.m<sup>-2</sup>" unit_latex="A \cdot m^{-2}"/>
                <quantity id="rf_current_density_external_imag" name="Current dens. - ext. - imag" shortname="Jei" unit="A/m2" unit_html="A.m<sup>-2</sup>" unit_latex="A \cdot m^{-2}"/>
            </group>
        </volume>
        <surface>
            <group>
                <quantity id="rf_electric_field_real" name="Electric field - real" shortname="Er" unit="V/m" unit_html="V.m<sup>-1</sup>" unit_latex="V \cdot m^{-1}"/>
                <quantity id="rf_electric_field_imag" name="Electric field - imag" shortname="Ei" unit="V/m" unit_html="V.m<sup>-1</sup>" unit_latex="V \cdot m^{-1}"/>
                <quantity id="rf_magnetic_field_real" name="Magnetic field - real" shortname="Hr" unit="A/m" unit_html="A.m<sup>-1</sup>" unit_latex="A \cdot m^{-1}"/>
                <quantity id="rf_magnetic_field_imag" name="Magnetic field - imag" shortname="Hi" unit="A/m" unit_html="A.m<sup>-1</sup>" unit_latex="A \cdot m^{-1}" />
                <quantity id="rf_surface_current_real" name="Surface current - real" shortname="Jr" unit="A/m2" unit_html="A.m<sup>-2</sup>" unit_latex="A \cdot m^{-2}"/>
                <quantity id="rf_surface_current_imag" name="Surface current - imag" shortname="Ji" unit="A/m2" unit_html="A.m<sup>-2</sup>" unit_latex="A \cdot m^{-2}"/>
                <quantity id="rf_port_power" name="Power" shortname="P" unit="W" />
                <quantity id="rf_port_phase" name="Phase" shortname="alpha" unit="deg." />
            </group>
        </surface>
    </preprocessor>

    <postprocessor>
        <localvariables>
            <localvariable id="rf_electric_field_real" name="Electric field - real" shortname="Er" unit="V/m" unit_html="V.m<sup>-1</sup>" unit_latex="V \cdot m^{-1}" type="scalar">
                <expression analysistype="harmonic" planar_scalar="value1"
                                                    axi_scalar="value1" />
            </localvariable>
            <localvariable id="rf_electric_field_imag" name="Electric field - imag" shortname="Ei" unit="V/m" unit_html="V.m<sup>-1</sup>" unit_latex="V \cdot m^{-1}" type="scalar">
                <expression analysistype="harmonic" planar_scalar="value2"
                                                    axi_scalar="value2" />
            </localvariable>
            <localvariable id="rf_displacement_real" name="Displacement - real" shortname="Dr" unit="C/m2" unit_html="C.m<sup>-2</sup>" unit_latex="C \cdot m^{-2}" type="scalar">
                <expression analysistype="harmonic" planar_scalar="epsr * EPS0 * value1"
                                                    axi_scalar="epsr * EPS0 * value1" />
            </localvariable>
            <localvariable id="rf_displacement_imag" name="Displacement - imag" shortname="Di" unit="C/m2" unit_html="C.m<sup>-2</sup>" unit_latex="C \cdot m^{-2}" type="scalar">
                <expression analysistype="harmonic" planar_scalar="epsr * EPS0 * value2"
                                                    axi_scalar="epsr * EPS0 * value2" />
            </localvariable>
            <localvariable id="rf_surface_current_real" name="Current density - real" shortname="Jr" unit="A/m2" unit_html="A.m<sup>-2</sup>" unit_latex="A \cdot m^{-2}" type="scalar">
                <expression analysistype="harmonic" planar_scalar="gamma * value1"
                                                    axi_scalar="gamma * value1" />
            </localvariable>
            <localvariable id="rf_surface_current_imag" name="Current density - imag" shortname="Ji" unit="A/m2" unit_html="A.m<sup>-2</sup>" unit_latex="A \cdot m^{-2}" type="scalar">
                <expression analysistype="harmonic" planar_scalar="gamma * value2"
                                                    axi_scalar="gamma * value2" />
            </localvariable>
            <localvariable id="rf_magnetic_field_real" name="Magnetic field - real" shortname="Hr" unit="A/m" unit_html="A.m<sup>-1</sup>" unit_latex="A \cdot m^{-1}" type="vector">
                <expression analysistype="harmonic" planar_x="- 1.0 / (2.0 * PI * f * mur * MU0) * dy2"
                                                    planar_y="1.0 / (2.0 * PI * f * mur * MU0) * dx2"
                                                    axi_r="- 1.0 / (2.0 * PI * f * mur * MU0) * dz2"
                                                    axi_z="1.0 / (2.0 * PI * f * mur * MU0) * dr2" />
            </localvariable>
            <localvariable id="rf_magnetic_field_imag" name="Magnetic field - imag" shortname="Hi" unit="A/m" unit_html="A.m<sup>-1</sup>" unit_latex="A \cdot m^{-1}" type="vector">
                <expression analysistype="harmonic" planar_comp_x="1.0 / (2.0 * PI * f * mur * MU0) * dy1"
                                                    planar_comp_y="1.0 / (2.0 * PI * f * mur * MU0) * dx1"
                                                    axi_comp_r="1.0 / (2.0 * PI * f * mur * MU0) * dz1"
                                                    axi_comp_z="1.0 / (2.0 * PI * f * mur * MU0) * dr1" />
            </localvariable>
            <localvariable id="rf_flux_density_real" name="Flux density - real" shortname="Br" unit="T" type="vector">
                <expression analysistype="harmonic" planar_comp_x="- 1.0 / (2.0 * PI * f) * dy2"
                                                    planar_comp_y="1.0 / (2.0 * PI * f) * dx2"
                                                    axi_comp_r="- 1.0 / (2.0 * PI * f) * dz2"
                                                    axi_comp_z="1.0 / (2.0 * PI * f) * dr2" />
            </localvariable>
            <localvariable id="rf_flux_density_imag" name="Flux density - imag" shortname="Bi" unit="T" type="vector">
                <expression analysistype="harmonic" planar_comp_x="1.0 / (2.0 * PI * f) * dy1"
                                                    planar_comp_y="1.0 / (2.0 * PI * f) * dx1"
                                                    axi_comp_r="1.0 / (2.0 * PI * f) * dz1"
                                                    axi_comp_z="1.0 / (2.0 * PI * f) * dr1" />
            </localvariable>
            <localvariable id="rf_poynting_vector" name="Poyting vector" shortname="N" unit="W/m2" unit_html="W.m<sup>-2</sup>" unit_latex="W \cdot m^{-2}" type="vector">
                <expression analysistype="harmonic" planar_comp_x="0.5 / (2.0 * PI * f * mur * MU0) * (value2 * dx1 - value1 * dx2)"
                                                    planar_comp_y="0.5 / (2.0 * PI * f * mur * MU0) * (value2 * dy1 - value1 * dy2)"
                                                    axi_comp_r="0.5 / (2.0 * PI * f * mur * MU0) * (value2 * dr1 - value1 * dr2)"
                                                    axi_comp_z="0.5 / (2.0 * PI * f * mur * MU0) * (value2 * dz1 - value1 * dz2)" />
            </localvariable>
            <localvariable id="rf_permittivity" name="Permittivity" shortname="epsr" unit="-" type="scalar">
                <expression analysistype="harmonic" planar_scalar="epsr"
                                                    axi_scalar="epsr" />
            </localvariable>
            <localvariable id="rf_permeability" name="Permeability" shortname="mur" unit="-" type="scalar">
                <expression analysistype="harmonic" planar_scalar="mur"
                                                    axi_scalar="mur" />
            </localvariable>
            <localvariable id="rf_conductivity" name="Conductivity" shortname="gamma" unit="S/m" unit_html="S.m<sup>-1</sup>" unit_latex="S \cdot m^{-1}" type="scalar">
                <expression analysistype="harmonic" planar_scalar="gamma"
                                                    axi_scalar="gamma" />
            </localvariable>
        </localvariables>

        <view>
            <scalar>
                <default analysistype="harmonic" default="rf_electric_field_real"/>
            </scalar>
            <vector>
                <default analysistype="harmonic" default="rf_magnetic_field_real"/>
            </vector>
        </view>

        <volumeintegrals>
            <volumeintegral id="rf_volume" name="Volume" shortname="V" unit="m3" unit_html="m<sup>3</sup>" unit_latex="m^{3}">
                <expression analysistype="harmonic" planar="1.0"
                                                    axi="2.0 * PI * r" />
            </volumeintegral>
            <volumeintegral id="rf_cross_section" name="Cross section" shortname="S" unit="m2" unit_html="m<sup>2</sup>" unit_latex="m^{2}">
                <expression analysistype="harmonic" planar="1.0"
                                                    axi="1.0" />
            </volumeintegral>
        </volumeintegrals>

        <surfaceintegrals>
            <surfaceintegral id="rf_length" name="Length" shortname="l" unit="m">
                <expression analysistype="harmonic" planar="1.0"
                                                    axi="1.0" />
            </surfaceintegral>
            <surfaceintegral id="rf_surface" name="Surface" shortname="S" unit="m2" unit_html="m<sup>2</sup>" unit_latex="m^{2}">
                <expression analysistype="harmonic" planar="1.0"
                                                    axi="2.0 * PI * r" />
            </surfaceintegral>
        </surfaceintegrals>
    </postprocessor>
</module>
