# Setup the Source files for the individual libraries which 
# together form the Netgen-mesher

# Get the actual path to the source directory
STRING (REGEX REPLACE "/cmake/build/" "/" CURRENT_SRC_PATH ${CMAKE_CURRENT_SOURCE_DIR})

# Get a list of all the source files in the directory	
FILE (GLOB INCLUDED_SRCS 
      "${CURRENT_SRC_PATH}/*.cpp" 
      "${CURRENT_SRC_PATH}/demoview.hpp"
	  "${CURRENT_SRC_PATH}/parallelfunc.hpp"
	  "${CURRENT_SRC_PATH}/togl_1_7.h"
	  )

# List all the explicitly excluded files here
SET (EXCLUDED_SRCS 
	 "${CURRENT_SRC_PATH}/parallelinterface.cpp"
	)
LIST(LENGTH EXCLUDED_SRCS LENGTH_EXCLUDED)

# Remove all the excluded files from the above generated list
IF(LENGTH_EXCLUDED GREATER 0)
	LIST (REMOVE_ITEM INCLUDED_SRCS ${EXCLUDED_SRCS})
ENDIF(LENGTH_EXCLUDED GREATER 0)

INCLUDE_DIRECTORIES("${NETGEN_LIBSRC_DIR}/interface")
INCLUDE_DIRECTORIES("${CURRENT_SRC_PATH}")


# On a Visual Studio platform, the resource files need to be modified
# to include the version number into the file, as well as the icon 
# for the executable
IF(MSVC OR MSVC_IDE)
	CONFIGURE_FILE(${CMAKE_CURRENT_SOURCE_DIR}/${NETGEN_ICON_FILE} ${CMAKE_CURRENT_BINARY_DIR}/${NETGEN_ICON_FILE} COPYONLY)
	CONFIGURE_FILE(${CMAKE_CURRENT_SOURCE_DIR}/resource.h ${CMAKE_CURRENT_BINARY_DIR}/resource.h COPYONLY)
	CONFIGURE_FILE(${CMAKE_CURRENT_SOURCE_DIR}/${PROJECT_NAME}.rc.cmake ${CMAKE_CURRENT_BINARY_DIR}/${PROJECT_NAME}.rc)
	
	SET(INCLUDED_SRCS ${INCLUDED_SRCS} ${CMAKE_CURRENT_BINARY_DIR}/${PROJECT_NAME}.rc)
ENDIF(MSVC OR MSVC_IDE)	
	

# Create the Base Package
ADD_EXECUTABLE (${PROJECT_NAME} ${INCLUDED_SRCS})
SET_TARGET_PROPERTIES(${PROJECT_NAME} PROPERTIES ENABLE_EXPORTS TRUE)
TARGET_LINK_LIBRARIES(${PROJECT_NAME} LINK_INTERFACE_LIBRARIES)
TARGET_LINK_LIBRARIES(${PROJECT_NAME} ${EXT_LIB_LIBRARIES} ${NETGEN_INT_LIBS} ${NETGEN_VIS_LIBS})

SET(NETGEN_EXE_PATH ${CMAKE_CURRENT_BINARY_DIR} CACHE INTERNAL "Points to the .lib file produced by netgen")

# Set up the installation options
FILE (GLOB INCLUDED_SCRIPTS
      "${CURRENT_SRC_PATH}/*.tcl"
	  "${CURRENT_SRC_PATH}/*.ocf"
	  )

SET (EXCLUDED_SCRIPTS
     ""
     )
LIST(LENGTH EXCLUDED_SCRIPTS LENGTH_EXCL_SCRIPTS)

IF(LENGTH_EXCL_SCRIPTS GREATER 0)
	LIST (REMOVE_ITEM INCLUDED_SCRIPTS ${EXCLUDED_SCRIPTS})
ENDIF(LENGTH_EXCL_SCRIPTS GREATER 0)

FILE (GLOB INCLUDED_HEADERS
      "${NETGEN_BASE_INCLUDES}/nginterface*.*"
	  )

INSTALL (TARGETS ${PROJECT_NAME} 
		 RUNTIME DESTINATION bin
		 LIBRARY DESTINATION lib
		 ARCHIVE DESTINATION lib
		 )

INSTALL (FILES ${INCLUDED_SCRIPTS} DESTINATION bin)
INSTALL (FILES ${INCLUDED_HEADERS} DESTINATION include)
